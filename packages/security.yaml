alarmdecoder:
  device:
    type: socket
    host: 192.168.101.17
    port: 10000
  panel_display: on
  zones:
    02:
      name: 'Sump Pump'
      type: 'moisture'
    03:
      name: 'Motion Garage'
      type: 'motion'
    09:
      name: 'Smoke Alarm 2nd'
      type: 'smoke'
    10:
      name: 'Door Back'
      type: 'door'
    11:
      name: 'Door Mudroom'
      type: 'door'
    12:
      name: 'Motion Hallway'
      type: 'motion'
    13:
      name: 'Door Front'
      type: 'door'
    14:
      name: 'Door Patio'
      type: 'door'

homeassistant:
  customize:
    binary_sensor.sump_pump:
      icon: mdi:cup-water


input_select:
  alarm_mode:
    name: Alarm mode
    options:
     - automatic
     - standby
    initial: automatic
    icon: mdi:security-home

switch:
  - platform: template
    switches:
      alarm_chime:
        friendly_name: Chime
        value_template: "{{ is_state_attr('alarm_control_panel.alarm_panel', 'chime', true) }}"
        turn_on:
          service: alarm_control_panel.alarmdecoder_alarm_toggle_chime
          data:
            code: !secret alarm_pin
        turn_off:
          service: alarm_control_panel.alarmdecoder_alarm_toggle_chime
          data:
            code: !secret alarm_pin
        icon_template: >-
            {% if is_state_attr('alarm_control_panel.alarm_panel', 'chime', true) %}
              mdi:bell-ring
            {% else %}
              mdi:bell-off
            {% endif %}

automation:
  # Automation Logic
  - alias: Arm the AWAY alarm
    trigger:
      platform: state
      entity_id: group.family
      from: 'on'
      to: 'off'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.alarm_mode
          state: 'automatic'
    action:
      - service: alarm_control_panel.alarm_arm_away
        data:
          entity_id: alarm_control_panel.alarm_panel
          code: !secret alarm_pin
      - service: switch.turn_on
        entity_id: group.cameras

  - alias: Disarm the AWAY alarm
    trigger:
      platform: state
      entity_id: group.family
      from: 'off'
      to: 'on'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.alarm_mode
          state: 'automatic'
    action:
      - service: alarm_control_panel.alarm_disarm
        data:
          entity_id: alarm_control_panel.alarm_panel
          code: !secret alarm_pin
      - service: switch.turn_off
        entity_id: group.cameras

  - alias: Arm the alarm HOME at 11:00pm
    trigger:
      platform: time
      at: '23:00:00'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.alarm_mode
          state: 'automatic'
        - condition: state
          entity_id: group.family
          state: 'on'
    action:
      - service: alarm_control_panel.alarm_arm_home
        data:
          entity_id: alarm_control_panel.alarm_panel
          code: !secret alarm_pin
      - service: switch.turn_on
        entity_id: group.cameras

  - alias: Disarm the alarm HOME at 6:00am
    trigger:
      platform: time
      at: '06:00:00'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_select.alarm_mode
          state: 'automatic'
        - condition: state
          entity_id: group.family
          state: 'on'
    action:
      - service: alarm_control_panel.alarm_disarm
        data:
          entity_id: alarm_control_panel.alarm_panel
          code: !secret alarm_pin
      - service: switch.turn_off
        entity_id: group.cameras

  - alias: Alert when door is opened for too long
    trigger:
      - platform: state
        entity_id: binary_sensor.door_front, binary_sensor.door_back, binary_sensor.door_mudroom, binary_sensor.door_patio
        from: 'off'
        to: 'on'
        for:
            minutes: 1
            seconds: 00
    action:
      service: notify.all
      data_template:
        title: "A door has been left opened"
        message: "Front:{{states('binary_sensor.door_front')}} Back:{{states('binary_sensor.door_back')}} Mudroom:{{states('binary_sensor.door_mudroom')}} Patio:{{states('binary_sensor.door_patio')}} "
        data:
            icon: "https://goo.gl/xeetdy"
            vibration: "0,65,706,86,657,95,668,100"

  - alias: Alarm triggered
    trigger:
      - platform: state
        entity_id: alarm_control_panel.alarm_panel
        to: 'triggered'
    action:
      service: notify.all
      data_template:
        title: "Alarm has triggered!"
        message: "Alarm has triggered: {{states('sensor.alarm_panel_display')}}"
        data:
            icon: "https://goo.gl/xeetdy"
            vibration: "0,65,706,86,657,95,668,100"
